<!doctype html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Walkability — Inputs</title>
    <link rel="stylesheet" href="../static/site.css">
</head>

<body>
    <div class="container">
        <h1>Walkability (MVP)</h1>
        <form id="walk-form" class="card">
            <label>Location label
                <input type="text" name="location" placeholder="e.g., Home in Montréal" required>
            </label>

            <div class="grid">
                <label>Latitude
                    <input type="number" step="any" name="lat" value="45.5017" required>
                </label>
                <label>Longitude
                    <input type="number" step="any" name="lon" value="-73.5673" required>
                </label>
            </div>

            <label>Cutoff distance (meters)
                <input type="number" name="cutoff_m" value="800" min="100" required>
            </label>

            <h3>Weights (0–5)</h3>
            <div class="grid">
                <label>Grocery
                    <input type="number" step="0.5" name="w_grocery" value="3" min="0" max="5" required>
                </label>
                <label>Restaurants
                    <input type="number" step="0.5" name="w_restaurants" value="2" min="0" max="5" required>
                </label>
                <label>Parks
                    <input type="number" step="0.5" name="w_parks" value="2" min="0" max="5" required>
                </label>
                <label>Schools
                    <input type="number" step="0.5" name="w_schools" value="2" min="0" max="5" required>
                </label>
                <label>Transit
                    <input type="number" step="0.5" name="w_transit" value="3" min="0" max="5" required>
                </label>
                <label>Healthcare
                    <input type="number" step="0.5" name="w_healthcare" value="2" min="0" max="5" required>
                </label>
            </div>

            <h3>Best walking distance to each category (meters)</h3>
            <div class="grid">
                <label>Grocery <input type="number" name="grocery_m" value="500" min="0" required></label>
                <label>Restaurants <input type="number" name="restaurants_m" value="300" min="0" required></label>
                <label>Parks <input type="number" name="parks_m" value="400" min="0" required></label>
                <label>Schools <input type="number" name="schools_m" value="800" min="0" required></label>
                <label>Transit <input type="number" name="transit_m" value="200" min="0" required></label>
                <label>Healthcare <input type="number" name="healthcare_m" value="1000" min="0" required></label>
            </div>

            <button type="submit">Calculate</button>
        </form>
    </div>

    <script>
        document.getElementById('walk-form').addEventListener('submit', function (e) {
            e.preventDefault();
            const fd = new FormData(this);

            // --- collect thresholds and weights from form ---
            const thresholds = {
                grocery: Number(fd.get("grocery_m")),
                restaurants: Number(fd.get("restaurants_m")),
                parks: Number(fd.get("parks_m")),
                schools: Number(fd.get("schools_m")),
                transit: Number(fd.get("transit_m")),
                healthcare: Number(fd.get("healthcare_m")),
            };

            const weights = {
                grocery: Number(fd.get("w_grocery")),
                restaurants: Number(fd.get("w_restaurants")),
                parks: Number(fd.get("w_parks")),
                schools: Number(fd.get("w_schools")),
                transit: Number(fd.get("w_transit")),
                healthcare: Number(fd.get("w_healthcare")),
            };

            const payload = {
                lat: Number(fd.get("lat")),
                lon: Number(fd.get("lon")),
                thresholds,
                weights
            };

            // --- send to FastAPI backend ---
            fetch("/api/analyze", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            })
                .then((r) => {
                    if (!r.ok) throw new Error("Server error: " + r.status);
                    return r.json();
                })
                .then((result) => {
                    // store backend result for result.html
                    sessionStorage.setItem("walkability_result", JSON.stringify(result));
                    window.location.href = "/result";
                })
                .catch((err) => {
                    console.error("Error calling backend:", err);
                    alert("Failed to calculate walkability. See console for details.");
                });
        });
    </script>        
</body>

</html>